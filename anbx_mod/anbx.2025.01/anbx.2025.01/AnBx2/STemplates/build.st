<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!-- This file was automatically generated by the AnBx Compiler $if(showverdatetime)$$version$ on $datetime$ $endif$-->
<project name="$package$" basedir="." default="run">
	<property name="main-class" value="$prot$"/>
	<property name="src" value="."/>
	<property name="AnBxJ.dir" value="$anbjxdir$"/>
	<property name="build" value="../../bin/"/>
    $if(jfr)$\<property name=\"jfrlabel\" value=\"$jfrlabel$\"/>$endif$
	<path id="my_classpath">
		<pathelement location="\${build}/"/>
		<fileset dir="\${AnBxJ.dir}" includes="*.jar" />
	</path>
    <tstamp>
      <format property="TIMESTAMP" pattern="yyyyMMdd_HHmmss-SSS" locale="en,UK" />
    </tstamp>
    <target name="init">
	    <mkdir dir="\${build}/\${ant.project.name}"/>
	  </target>
    <target name="clean">
        <delete dir="\${build}/\${ant.project.name}"/>
        <delete>
    	    <fileset dir=".">
    	        <include name="*.jfr"/>
    	    </fileset>
    	</delete>
    </target>
	<target name="compile" depends="init">
	<copy file="\$\{main-class\}.properties" todir="\${build}/\${ant.project.name}"/>
	    <javac srcdir="\${src}" destdir="\${build}" classpathref="my_classpath" includeantruntime="false"/>
	  </target>
	<target name="runinit" depends="compile">
		   <java classname=\"\$\{ant.project.name\}.\$\{main-class\}_Setup\" failonerror=\"true\" fork=\"yes\">
           <classpath refid=\"my_classpath"/>
	    </java>
    </target>
    <target name="objcheck" depends="clean,compile">
		   <java classname=\"\$\{ant.project.name\}.\$\{main-class\}_ObjCheck\" failonerror=\"true\" fork=\"yes\">
           <classpath refid=\"my_classpath"/>
	</java>
    </target>
    <target name="runinfo">
           <java classname=\"\$\{ant.project.name\}.\$\{main-class\}_Setup\" failonerror=\"true\" fork=\"yes\">
           <arg line="-info" />
           <classpath refid=\"my_classpath"/>
        </java>
    </target>$roles:{n|
	<target name="$n$"  >
		                <java classname=\"\$\{ant.project.name\}.\$\{main-class\}\" failonerror=\"true\" fork=\"yes\"> 
		                    <arg line=\"-r $n$\" />
                            <arg line=\"-jsessions $jsessions$" />
		                    <classpath refid="my_classpath"/>
                            $if(jfr)$\<jvmarg line =\"-XX:StartFlightRecording=settings=$jfrsettings$,filename=\$\{main-class\}_$n$_\$\{jfrlabel\}\$\{TIMESTAMP\}.jfr\"/>$endif$
                        </java>
	</target>}$
    <target name="runagents" depends="compile">
        <parallel>$roles:{n|
		  <antcall target="$n$" inheritAll="false"></antcall>}$
        </parallel>
    </target>
	<target name="run" depends="runinit,runagents">
    </target>		
	<target name="speedtest" depends="runinit">
		<sequential>
		   <echo message="Running 10 times the protocol \$\{main-class\}"/>
		   <antcall target="runagents" inheritAll="false"></antcall>
		   <antcall target="runagents" inheritAll="false"></antcall>
		   <antcall target="runagents" inheritAll="false"></antcall>
		   <antcall target="runagents" inheritAll="false"></antcall>
		   <antcall target="runagents" inheritAll="false"></antcall>
		   <antcall target="runagents" inheritAll="false"></antcall>
		   <antcall target="runagents" inheritAll="false"></antcall>
		   <antcall target="runagents" inheritAll="false"></antcall>
		   <antcall target="runagents" inheritAll="false"></antcall>
		   <antcall target="runagents" inheritAll="false"></antcall>
	    </sequential>
		<echo message="Protocol \$\{main-class\} completed"/>
    </target>
</project>